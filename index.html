<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Xenocrypt Practice</title>
  <style>
    body {
      background-color: #ffffff;
      color: #000000;
      font-family: Arial, sans-serif;
      text-align: center;
    }

    #game-container {
      max-width: 600px;
      margin: auto;
      padding: 20px;
      background: #f0f0f0;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    #alphabet-grid {
      display: grid;
      grid-template-columns: repeat(26, 1fr);
      gap: 5px;
      margin: 20px auto;
      max-width: 1200px;
    }

    .letter-column {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .frequency-box {
      width: 30px;
      text-align: center;
      padding: 5px;
      background-color: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 3px;
      margin-bottom: 5px;
    }

    .letter-box {
      width: 30px;
      text-align: center;
      font-size: 1.2em;
      padding: 5px;
      background-color: #e0e0e0;
      border: 1px solid #ccc;
      border-radius: 3px;
      margin-bottom: 5px;
    }

    .input-box {
      width: 30px;
      text-align: center;
      font-size: 1.2em;
      border: 1px solid #ccc;
      padding: 5px;
      background-color: #ffffff;
      border-radius: 0 0 3px 3px;
    }

    .input-box:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
      background-color: #f0f8ff;
    }

    #submit-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 5px;
      margin-top: 20px;
    }

    #submit-btn:hover {
      background: #0056b3;
    }

    #error-message {
      color: red;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
      margin-top: 10px;
    }

    #error-message.show {
      opacity: 1;
    }

    #frequency-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
      padding: 15px;
      background: #f8f8f8;
      border-radius: 5px;
    }

    .frequency-box {
      padding: 8px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      min-width: 60px;
    }

    .cipher-char {
      font-weight: bold;
      font-size: 1.2em;
      color: #007bff;
    }

    .mapped-char {
      color: #28a745;
    }

    .frequency {
      color: #6c757d;
      font-size: 0.9em;
    }
  </style>
</head>

<body>
  <div id="game-container">
    <h1>Spanish Aristocrat Cipher</h1>
    <div id="alphabet-grid"></div>
    <button id="submit-btn">Submit</button>
    <p id="error-message">Incorrect! Try again.</p>
  </div>
  <script>
    let originalText = "el conocimiento es poder";
    let alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    let cipherMap = {};
    let decipherMap = {};
    let currentFocusIndex = 0;
    let inputs = [];

    function generateCipher() {
      let alphabet = "abcdefghijklmnopqrstuvwxyz";
      let shuffled = alphabet.split('').sort(() => Math.random() - 0.5).join('');
      for (let i = 0; i < alphabet.length; i++) {
        cipherMap[alphabet[i]] = shuffled[i];
        decipherMap[shuffled[i]] = alphabet[i];
      }
    }

    function encodeText(text) {
      return text.split('').map(char => cipherMap[char] || char).join('');
    }

    function updateSimilarInputs(value, cipherChar) {
      inputs.forEach(input => {
        if (input.dataset.cipher === cipherChar) {
          input.value = value;
        }
      });
    }

    function findNextEmptyBox(startIndex) {
      for (let i = startIndex; i < inputs.length; i++) {
        if (!inputs[i].value) {
          return i;
        }
      }
      return -1;
    }

    function moveFocus(index) {
      if (index >= 0 && index < inputs.length) {
        inputs[index].focus();
        currentFocusIndex = index;
      }
    }

    function updateFrequencyAnalysis() {
      const frequencyContainer = document.getElementById("frequency-container");
      const frequencies = {};
      const mappings = {};
      
      inputs.forEach(input => {
        const cipher = input.dataset.cipher;
        if (cipher !== ' ') {
          frequencies[cipher] = (frequencies[cipher] || 0) + 1;
          mappings[cipher] = input.value.toUpperCase() || '';
        }
      });

      frequencyContainer.innerHTML = '';
      Object.entries(frequencies)
        .sort((a, b) => b[1] - a[1])
        .forEach(([char, freq]) => {
          const box = document.createElement('div');
          box.className = 'frequency-box';
          box.innerHTML = `
            <div class="cipher-char">${char.toUpperCase()}</div>
            <div class="mapped-char">${mappings[char] || '-'}</div>
            <div class="frequency">${freq}x</div>
          `;
          frequencyContainer.appendChild(box);
        });
    }

    function calculateFrequencies(text) {
      const frequencies = {};
      text.toUpperCase().split('').forEach(char => {
        if (char >= 'A' && char <= 'Z') {
          frequencies[char] = (frequencies[char] || 0) + 1;
        }
      });
      return frequencies;
    }

    function displayAlphabetGrid() {
      const grid = document.getElementById("alphabet-grid");
      grid.innerHTML = '';
      inputs = [];
      const frequencies = calculateFrequencies(encodeText(originalText));

      alphabet.split('').forEach(letter => {
        const column = document.createElement("div");
        column.className = "letter-column";

        // Frequency box
        const freqBox = document.createElement("div");
        freqBox.className = "frequency-box";
        freqBox.textContent = frequencies[letter] || 0;

        // Letter box
        const letterBox = document.createElement("div");
        letterBox.className = "letter-box";
        letterBox.textContent = letter;

        // Input box
        const input = document.createElement("input");
        input.type = "text";
        input.maxLength = 1;
        input.className = "input-box";
        input.dataset.letter = letter;
        inputs.push(input);

        input.addEventListener('input', (e) => {
          let value = e.target.value.toUpperCase();
          if (value && value.length === 1) {
            let nextIndex = inputs.indexOf(e.target) + 1;
            if (nextIndex < inputs.length) {
              inputs[nextIndex].focus();
            }
          }
        });

        input.addEventListener('keydown', (e) => {
          let currentIndex = inputs.indexOf(e.target);
          if (e.key === 'ArrowLeft') {
            if (currentIndex > 0) {
              inputs[currentIndex - 1].focus();
            }
            e.preventDefault();
          } else if (e.key === 'ArrowRight') {
            if (currentIndex < inputs.length - 1) {
              inputs[currentIndex + 1].focus();
            }
            e.preventDefault();
          }
        });

        column.appendChild(freqBox);
        column.appendChild(letterBox);
        column.appendChild(input);
        grid.appendChild(column);
      });
    }

    function displayCipherText() {
      displayAlphabetGrid();
        let wordContainer = document.createElement("div");
        wordContainer.classList.add("word-container");

        word.split('').forEach((char, charIndex) => {
          let letterContainer = document.createElement("div");
          letterContainer.classList.add("letter-container");

          let cipherBox = document.createElement("span");
          cipherBox.classList.add("cipher-box");
          cipherBox.textContent = char.toUpperCase();
          letterContainer.appendChild(cipherBox);

          let input = document.createElement("input");
          input.type = "text";
          input.maxLength = 1;
          input.classList.add("input-box");
          input.dataset.cipher = char;
          input.dataset.index = inputs.length;
          inputs.push(input);
          letterContainer.appendChild(input);
          wordContainer.appendChild(letterContainer);

          input.addEventListener('input', (e) => {
            let value = e.target.value.toUpperCase();
            if (value && value.length === 1) {
              updateSimilarInputs(value, char);
              updateFrequencyAnalysis();
              let nextEmptyIndex = findNextEmptyBox(parseInt(e.target.dataset.index) + 1);
              moveFocus(nextEmptyIndex !== -1 ? nextEmptyIndex : parseInt(e.target.dataset.index) + 1);
            }
          });

          input.addEventListener('keydown', (e) => {
            let currentIndex = parseInt(e.target.dataset.index);

            if (e.key === 'Backspace') {
              if (e.target.value) {
                updateSimilarInputs('', char);
                e.preventDefault();
              } else {
                moveFocus(currentIndex - 1);
                e.preventDefault();
              }
            } else if (e.key === 'ArrowLeft') {
              moveFocus(currentIndex - 1);
              e.preventDefault();
            } else if (e.key === 'ArrowRight') {
              let nextEmptyIndex = findNextEmptyBox(currentIndex + 1);
              moveFocus(nextEmptyIndex !== -1 ? nextEmptyIndex : currentIndex + 1);
              e.preventDefault();
            } else if (e.key === ' ') {
              e.preventDefault();
              updateSimilarInputs(' ', char);
              moveFocus(currentIndex + 1);
            }
          });

        });
        cipherContainer.appendChild(wordContainer);
      });
    }

    document.getElementById("submit-btn").addEventListener("click", function () {
      let userAttempt = '';
      let lastWasSpace = false;

      for (let input of inputs) {
        if (input.dataset.cipher === ' ') {
          if (!lastWasSpace) {
            userAttempt += ' ';
            lastWasSpace = true;
          }
        } else {
          userAttempt += (input.value || '?').toLowerCase();
          lastWasSpace = false;
        }
      }

      let errorMessage = document.getElementById("error-message");
      let noSpaces = originalText.replace(/\s/g, '');
      if (userAttempt.toLowerCase() === noSpaces.toLowerCase()) {
        alert("Correct! The quote is: " + originalText);
        location.reload();
      } else {
        errorMessage.classList.add("show");
        setTimeout(() => {
          errorMessage.classList.remove("show");
        }, 1000);
      }
    });

    generateCipher();
    displayCipherText();
    updateFrequencyAnalysis();
    if (inputs.length > 0) {
      inputs[0].focus();
    }
  </script>
</body>

</html>